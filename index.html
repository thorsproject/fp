<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">

<!---------- Debug-Option ----------> 
<script>
  window.addEventListener("error", (e) => {
    alert("JS ERROR:\n" + (e.message || e.error) + "\n" + (e.filename || "") + ":" + (e.lineno || ""));
  });
  window.addEventListener("unhandledrejection", (e) => {
    alert("PROMISE ERROR:\n" + (e.reason?.message || e.reason));
  });
</script>
<!---------- Debug-Option Ende----------> 

<!-- PWA -->
<link rel="manifest" href="manifest.json">

<meta name="theme-color" content="#1b1f24">
<!-- iOS Support -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Flight Planning">
<link rel="apple-touch-icon" href="icon-192.png">

<title>Flight Planning V0.1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Links zu CSS -->
<!-- Reihenfolge so lassen -->
<link rel="stylesheet" href="css/reset.css?v=1">
<link rel="stylesheet" href="css/base.css?v=1">
<link rel="stylesheet" href="css/layout.css?v=1">
<link rel="stylesheet" href="css/utils.css?v=1">
<link rel="stylesheet" href="css/components.css?v=1">
<link rel="stylesheet" href="css/overlays.css?v=1">

<link rel="stylesheet" href="css/views/route.css?v=1">
<link rel="stylesheet" href="css/views/map.css?v=1">
<link rel="stylesheet" href="css/views/checklist.css?v=1">
<link rel="stylesheet" href="css/views/fuel.css?v=1">
<link rel="stylesheet" href="css/views/performance.css?v=1">
<link rel="stylesheet" href="css/views/settings.css?v=1">

<!-- Link zum Java Script -->
<script type="module" src="js/app.js?v=2"></script>
</head>

<body>
  <header class="l-topbar">
    <div class="l-topbar__title">FLIGHT PLANNING V0.1</div>
    <!-- BUTTON TOPNAV -->
    <nav class="l-topbar__nav" id="topNav">
      <button class="c-btn c-tab" data-view="view-map">
        <span class="ico"><svg><use href="tools/icons.svg#i-map"></use></svg></span>MAP
      </button>
      <button type="button" class="c-btn c-tab" data-view="view-checklist">
        <span class="ico"><svg><use href="tools/icons.svg#i-checklist"></use></svg></span>CHECKLIST
      </button>
      <button type="button" class="c-btn c-tab" data-view="view-fuel">
        <span class="ico"><svg><use href="tools/icons.svg#i-fuel"></use></svg></span>FUEL PLANNING
      </button>
      <button type="button" class="c-btn c-tab" data-view="view-performance">
        <span class="ico"><svg><use href="tools/icons.svg#i-performance"></use></svg></span>PERFORMANCE
      </button>
      <button type="button" class="c-btn c-tab" data-view="view-settings">
        <span class="ico"><svg><use href="tools/icons.svg#i-settings"></use></svg></span>SETTINGS
      </button>

      <button type="button" class="c-btn c-tab" data-action="export-data"><span class="ico">üó∫Ô∏è</span>Export JSON</button>
      <button type="button" class="c-btn c-tab" data-action="import-data"><span class="ico">üó∫Ô∏è</span>Import JSON</button>
      <!-- optional: unsichtbarer file input -->
      <input id="importFile" type="file" accept="application/json" hidden>
    </nav>
    <div id="configBadge" class="config-badge is-off" title="Config Status">Config: OFF</div> <!-- Spalte 6 leer -->
    <div class="c-saveIndicator" id="saveIndicator" aria-live="polite"></div>
  </header>

  <div class="l-views">
    <!-- VIEW: Route + Map -->
    <section id="view-route" class="view is-active">
      <div class="l-shell">

        <!----- =======================
                LINKS: ROUTE (1 Panel)
                ======================= ---->
        <aside class="l-sidebar">
          <!----- Outer-Frame ----->
          <div class="c-panel c-panel--stack" id="routePanel">
            <div class="c-panel__head" id="kopfContainer">
              <div class="master-grid">
                <!-- Zeile 1 -->
                <div></div> <!-- Spalte 1 leer -->
                <div class="c-label">DATE</div> <!-- Spalte 2 -->
                <div><input class="c-input" type="text" id="dateInput" maxlength="8" placeholder="TT.MM.JJ"></div> <!-- Spalte 3 -->
                <div class="c-label aero-label">FDL</div> <!-- Spalte 4 -->
                <div class="c-span2"><output class="c-output c-output--mono" id="FDLoutput"></output></div> <!-- c-span2 = Spalte 5+6 -->

                <!-- Zeile 2 -->
                <div></div> <!-- Spalte 1 leer -->
                <div class="c-label">LFZ</div> <!-- Spalte 2 -->
                <div><select class="c-select" id="lfzSelect"></select></div> <!-- Spalte 3 -->
                <div class="c-label aero-label">TEL:</div> <!-- Spalte 4 -->
                <div class="c-span2"><output class="c-output c-output--mono" id="TELoutput"></output></div> <!-- c-span2 = Spalte 5+6 -->

                <!-- Zeile 3 -->
                <div></div> <!-- Spalte 1 leer -->
                <div class="c-label">CALL SIGN</div> <!-- Spalte 2 -->
                <div id="callSignDisplay" class="callSignDisplay"></div> <!-- Spalte 3: Anzeige CALL SIGN -->
                <div class="c-label aero-label">TAC-CS</div> <!-- Spalte 4 -->
                <div><select class="c-select" id="tacSelect"></select></div> <!-- Spalte 5 -->
                <div></div> <!-- Spalte 6 leer -->
              </div>
            </div>

            <!-- Body: scrollt (Legs) -->
            <div class="c-panel__body">
              <!-- FRAME 2-5 - LEGS -->
              <div id="legsContainer" data-include="partials/legs.html"></div>
            </div>
          </div>

          <datalist id="airfieldsList"></datalist>
          <datalist id="alternatesList"></datalist>

          <!-- REESET FOOTER -->
          <div class="c-resetBar">
            <div class="c-resetBar__inner">
              <button class="c-btn c-reset" data-action="reset-kopf">Reset Kopfdaten</button>
              <button class="c-btn c-reset" data-action="reset-times">Reset ETD/ETA</button>
              <button class="c-btn c-reset" data-action="reset-aeros">Reset AERODROMES</button>
            </div>
          </div>
        </aside>

        <!----- =======================
                RECHTS: Content Panel
                ======================= ---->
        <main class="l-main">

          <!-- VIEW: MAP -->
          <section id="view-map" class="view is-active">
            <div class="map-controls">
              <div class="ctrl-chip">
                <span>Weather</span>
                <button id="toggleWeather" type="button">OFF</button>
              </div>

              <div class="ctrl-chip">
                <span>Wind</span>
                <button id="toggleWind" type="button">OFF</button>
              </div>

              <div class="ctrl-chip">
                <span>Level</span>
                <select id="windLevelSelect">
                  <option value="SFC">SFC</option>
                  <option value="25">FL025</option>
                  <option value="50">FL050</option>
                  <option value="80">FL080</option>
                  <option value="100">FL100</option>
                  <option value="180">FL180</option>
                </select>
              </div>
            </div>
            <div class="map-frame" id="map"></div>
          </section>

          <!-- VIEW: CHECKLIST -->
          <section id="view-checklist" class="view">
            <div class="frame">
              <div class="checklist-card">
                <div class="check-head">
                  <h2 class="check-title">Planning-Checklist</h2>
                  <div class="check-toast is-hidden" id="checkToast" role="status" aria-live="polite"></div>
                </div>

                <div class="check-grid" data-include="partials/checklist.html"></div>
              </div>
            </div>
          </section>

          <!-- VIEW: FUEL -->
          <section id="view-fuel" class="view" data-include="partials/fuel.html"></section>

          <!-- VIEW: PERFORMANCE -->
          <section id="view-performance" class="view">
            <div class="frame">
              <h2 class="view-title">Performance</h2>
              <p class="view-sub">Platzhalter ‚Äì hier kommt Performance rein.</p>
            </div>
          </section>

          <!-- VIEW: SETTINGS -->
          <section id="view-settings" class="view" data-include="partials/settings.html"></section>

        </main>
      </div>
    </section>
  </div>

  <!-- ORM Overlay (au√üerhalb des Frames) -->
  <div id="ormOverlay" class="orm-overlay is-hidden" aria-hidden="true">
    <div class="orm-overlay-bar">
      <button id="btnOrmSaveOverlay" type="button">ORM speichern</button>
      <button id="btnOrmFinalizeOverlay" type="button">ORM finalisieren</button>
      <button id="btnOrmCloseOverlay" type="button">Schlie√üen</button>
      <span id="ormHintOverlay" class="hint"></span>
    </div>

    <iframe
      id="ormFrameOverlay"
      class="orm-overlay-frame"
      title="ORM Viewer"
      loading="lazy">
    </iframe>
  </div>
</body>
</html>