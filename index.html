<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">

<!---------- Debug-Option ----------> 
<script>
  window.addEventListener("error", (e) => {
    alert("JS ERROR:\n" + (e.message || e.error) + "\n" + (e.filename || "") + ":" + (e.lineno || ""));
  });
  window.addEventListener("unhandledrejection", (e) => {
    alert("PROMISE ERROR:\n" + (e.reason?.message || e.reason));
  });
</script>
<!---------- Debug-Option Ende----------> 

<!-- PWA -->
<link rel="manifest" href="manifest.json">

<meta name="theme-color" content="#1b1f24">
<!-- iOS Support -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Flight Planning">
<link rel="apple-touch-icon" href="icon-192.png">

<title>Flight Planning V0.1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Links zu CSS -->
<link rel="stylesheet" href="css/base.css?v=1">
<link rel="stylesheet" href="css/layout.css?v=1">
<link rel="stylesheet" href="css/utils.css?v=1">
<link rel="stylesheet" href="css/components.css?v=1">

<link rel="stylesheet" href="css/route.css?v=1">
<link rel="stylesheet" href="css/map.css?v=1">
<link rel="stylesheet" href="css/checklist.css?v=1">
<link rel="stylesheet" href="css/fuel.css?v=1">
<link rel="stylesheet" href="css/performance.css?v=1">
<link rel="stylesheet" href="css/reset.css?v=1">
<link rel="stylesheet" href="css/settings.css?v=1">


<!-- Link zum Java Script -->
<script type="module" src="js/app.js?v=1"></script>
</head>

<body>
  <header class="topbar">
    <div class="topbar-title">FLIGHT PLANNING V0.1</div>
    <!-- BUTTON TOPNAV -->
    <nav class="topbar-nav" id="topNav">
      <button type="button" class="topbtn active" data-view="view-map">MAP</button>
      <button type="button" class="topbtn" data-view="view-checklist">Checklist</button>
      <button type="button" class="topbtn" data-view="view-fuel">FUEL Planning</button>
      <button type="button" class="topbtn" data-view="view-performance">PERFORMANCE</button>
      <button type="button" class="topbtn" data-view="view-settings">Settings</button>
      <button type="button" class="topbtn" data-action="export-data">Export JSON</button>
      <button type="button" class="topbtn" data-action="import-data">Import JSON</button>
      <!-- optional: unsichtbarer file input -->
      <input id="importFile" type="file" accept="application/json" hidden>
    </nav>
    <div class="save-indicator" id="saveIndicator" aria-live="polite"></div>
  </header>

<div class="views">
  <!-- VIEW: Route + Map -->
  <section id="view-route" class="view is-active">
    <div class="layout">

      <!----- =======================
              LINKS: ROUTE (1 Panel)
              ======================= ---->
      <aside class="route-panel">
        <!----- Outer-Frame ----->
        <div class="frame panel-container" id="routePanel">
          <div class="panel-header" id="kopfContainer">
            <div class="master-grid">
              <!-- Zeile 1 -->
              <div></div> <!-- Spalte 1 leer -->
              <div class="label">DATE</div> <!-- Spalte 2 -->
              <div><input type="text" id="dateInput" maxlength="8" placeholder="TT.MM.JJ"></div> <!-- Spalte 3 -->
              <div class="label aero-label">FDL</div> <!-- Spalte 4 -->
              <div><input type="text" id="FDLinput"></div> <!-- Spalte 5 -->
              <div></div> <!-- Spalte 6 leer -->

              <!-- Zeile 2 -->
              <div></div> <!-- Spalte 1 leer -->
              <div class="label">LFZ</div> <!-- Spalte 2 -->
              <div><select id="lfzSelect"></select></div> <!-- Spalte 3 -->
              <div class="label aero-label">TEL:</div> <!-- Spalte 4 -->
              <div><input type="text" id="TELinput"></div> <!-- Spalte 5 -->
              <div></div> <!-- Spalte 6 leer -->

              <!-- Zeile 3 -->
              <div></div> <!-- Spalte 1 leer -->
              <div class="label">CALL SIGN</div> <!-- Spalte 2 -->
              <div id="callSignDisplay" class="callSignDisplay"></div> <!-- Spalte 3: Anzeige CALL SIGN -->
              <div class="label aero-label">TAC-CS</div> <!-- Spalte 4 -->
              <div><select id="tacSelect"></select></div> <!-- Spalte 5 -->
              <div></div> <!-- Spalte 6 leer -->
            </div>
          </div>

          <!-- Body: scrollt (Legs) -->
          <div class="panel-body">
            <!-- FRAME 2-5 - LEGS -->
            <div id="legsContainer" data-include="partials/legs.html"></div>
          </div>

          <!-- BUTTON Footer PANEL -->
          <div class="panel-footer">
            <div class="panel-footer-buttons">
              <button class="routebtnReset" data-action="reset-kopf">Reset Kopfdaten</button>
              <button class="routebtnReset" data-action="reset-times">Reset ETD/ETA</button>
              <button class="routebtnReset" data-action="reset-aeros">Reset AERODROMES</button>
            </div>
          </div>
        </div>

        <datalist id="airfieldsList"></datalist>
        <datalist id="alternatesList"></datalist>
      </aside>

      <!----- =======================
              RECHTS: Content Panel
              ======================= ---->
      <main class="content-panel">

        <!-- VIEW: MAP -->
        <section id="view-map" class="view is-active">
          <div class="map-controls">
            <div class="ctrl-chip">
              <span>Weather</span>
              <button id="toggleWeather" type="button">OFF</button>
            </div>

            <div class="ctrl-chip">
              <span>Wind</span>
              <button id="toggleWind" type="button">OFF</button>
            </div>

            <div class="ctrl-chip">
              <span>Level</span>
              <select id="windLevelSelect">
                <option value="SFC">SFC</option>
                <option value="25">FL025</option>
                <option value="50">FL050</option>
                <option value="80">FL080</option>
                <option value="100">FL100</option>
                <option value="180">FL180</option>
              </select>
            </div>
          </div>
          <div class="map-frame" id="map"></div>
        </section>

        <!-- VIEW: CHECKLIST -->
        <div class="checklist-card">
          <div class="check-head">
            <h2 class="check-title">Planning-Checklist</h2>
            <div class="check-toast is-hidden" id="checkToast" role="status" aria-live="polite"></div>
          </div>

          <div class="check-grid">
            <!-- Header -->
            <div class="cg-row cg-head">
              <div>ToDo</div>
              <div>Kontakt</div>
              <div>Aktion</div>
              <div>Details</div>
              <div>Status</div>
              <div></div>
            </div>

            <!-- 1) Anflüge anmelden -->
            <div class="cg-row">
              <div class="cg-todo">Anflüge anmelden</div>

              <div class="cg-contacts">
                <button class="chip phone-btn" data-phone-label="Wachleiter" data-phone="+49 000 000000">Wachleiter</button>
                <button class="chip phone-btn" data-phone-label="Bremen" data-phone="+49 421 000000">Bremen</button>
                <button class="chip phone-btn" data-phone-label="Langen" data-phone="+49 6103 000000">Langen</button>
                <button class="chip phone-btn" data-phone-label="München" data-phone="+49 89 000000">München</button>
              </div>

              <div class="cg-action">
                <span class="muted">—</span>
              </div>

              <div class="cg-details">
                <span class="muted">—</span>
              </div>

              <div class="cg-status">Anflüge angemeldet und genehmigt</div>

              <div class="cg-toggle">
                <button class="tb" data-tb="appr">UNCHECK</button>
              </div>
            </div>

            <!-- 2) lokale Anflüge absprechen -->
            <div class="cg-row">
              <div class="cg-todo">lokale Anflüge absprechen</div>

              <div class="cg-contacts">
                <button class="chip phone-btn" data-phone-label="Laage RDR" data-phone="+49 38454 000000">Laage RDR</button>
              </div>

              <div class="cg-action"><span class="muted">—</span></div>
              <div class="cg-details"><span class="muted">—</span></div>

              <div class="cg-status">Anflüge genehmigt</div>

              <div class="cg-toggle">
                <button class="tb" data-tb="local">UNCHECK</button>
              </div>
            </div>

            <!-- 3) Wx Check -->
            <div class="cg-row">
              <div class="cg-todo">Wx Check</div>

              <div class="cg-contacts">
                <button class="chip phone-btn" data-phone-label="Wx Münster" data-phone="+49 251 000000">Wx Münster</button>
              </div>

              <div class="cg-action">
                <label class="mini-field">
                  NR
                  <input class="mini-input" type="text" inputmode="numeric" data-field="wx_nr" placeholder="NR">
                </label>
                <label class="mini-field">
                  VOID
                  <input class="mini-input" type="text" data-field="wx_void" placeholder="VOID">
                </label>
                <label class="mini-field">
                  INITIALS
                  <input class="mini-input" type="text" data-field="wx_init" placeholder="ABC">
                </label>
              </div>

              <div class="cg-details"><span class="muted">—</span></div>

              <div class="cg-status">Wx angerufen</div>

              <div class="cg-toggle">
                <button class="tb" data-tb="wx">UNCHECK</button>
              </div>
            </div>

            <!-- 4) ORM Sheet -->
            <div class="cg-row">
              <div class="cg-todo">ORM-Sheet</div>

              <div class="cg-contacts"><span class="muted">—</span></div>

              <div class="cg-action">
                <!-- nutzt deinen existierenden Button -->
                <button id="btnOrm" type="button">ORM öffnen</button>
              </div>

              <div class="cg-details"><span class="muted">—</span></div>

              <div class="cg-status">ausgefüllt und gespeichert</div>

              <div class="cg-toggle">
                <button class="tb" data-tb="orm">UNCHECK</button>
              </div>
            </div>

            <!-- 5) Package send to -->
            <div class="cg-row">
              <div class="cg-todo">Package send to</div>

              <div class="cg-contacts">
                <span class="email">xxx@abc.de</span>
              </div>

              <div class="cg-action">
                <!-- nutzt deinen existierenden Button -->
                <button id="btnMailEO" type="button">Mail EO senden</button>
              </div>

              <div class="cg-details"><span class="muted">—</span></div>

              <div class="cg-status">eMail an EO gesendet</div>

              <div class="cg-toggle">
                <button class="tb" data-tb="eo">UNCHECK</button>
              </div>
            </div>
          </div>
        </div>


        <!-- VIEW: FUEL -->
        <section id="view-fuel" class="view" data-include="partials/fuel.html"></section>

        <!-- VIEW: PERFORMANCE -->
        <section id="view-performance" class="view">
          <div class="frame">
            <h2 class="view-title">Performance</h2>
            <p class="view-sub">Platzhalter – hier kommt Performance rein.</p>
          </div>
        </section>

        <!-- VIEW: SETTINGS -->
        <section id="view-settings" class="view">
          <div class="frame">
            <h2 class="view-title">Settings</h2>
            <p class="view-sub">Platzhalter – hier kommen Settings rein.</p>
          </div>
        </section>

      </main>
    </div>
  </section>
</div>
<!-- ORM Overlay (außerhalb des Frames) -->
<div id="ormOverlay" class="orm-overlay is-hidden" aria-hidden="true">
  <div class="orm-overlay-bar">
    <button id="btnOrmSaveOverlay" type="button">ORM speichern</button>
    <button id="btnOrmCloseOverlay" type="button">Schließen</button>
    <span id="ormHintOverlay" class="hint"></span>
  </div>

  <iframe
    id="ormFrameOverlay"
    class="orm-overlay-frame"
    title="ORM Viewer"
    loading="lazy">
  </iframe>
</div>

</body>
</html>