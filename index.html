<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<!---------- Debug-Option ----------> 
<script>
  window.addEventListener("error", (e) => {
    alert("JS ERROR:\n" + (e.message || e.error) + "\n" + (e.filename || "") + ":" + (e.lineno || ""));
  });
  window.addEventListener("unhandledrejection", (e) => {
    alert("PROMISE ERROR:\n" + (e.reason?.message || e.reason));
  });
</script>
<!---------- Debug-Option Ende----------> 

<!-- PWA -->
<link rel="manifest" href="manifest.json">

<meta name="theme-color" content="#1b1f24">

<!-- iOS Support -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Flight Planning">

<link rel="apple-touch-icon" href="icon-192.png">

<title>Flight Planning V0.1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Link zum CSS -->
<link rel="stylesheet" href="css/style.css?v=1">
<!-- Link zum Java Script -->
<script type="module" src="js/app.js?v=1"></script>

</head>
<body>

<header class="topbar">
  <div class="topbar-title">FLIGHT PLANNING V0.1</div>
  <!-- BUTTON TOPNAV -->
<nav class="topbar-nav" id="topNav">
  <button class="topbtn active" data-view="view-map" type="button">MAP</button>
  <button class="topbtn" data-view="view-checklist" type="button">Checklist</button>
  <button class="topbtn" data-view="view-fuel" type="button">FUEL Planning</button>
  <button class="topbtn" data-view="view-performance" type="button">PERFORMANCE</button>
  <button class="topbtn" data-view="view-settings" type="button">Settings</button>
  <button class="topbtn" data-view="view-orm" type="button">ORM öffnen</button>
  <button class="topbtn" data-view="view-mail" type="button">Mail EO senden</button>
</nav>
</header>

<div class="views">
  <!-- VIEW: Route + Map -->
  <section id="view-route" class="view is-active">
  <div class="layout">
    <!-- LINKS: Route immer sichtbar -->
    <aside class="route-panel">
      <div class="left-panel">
        <!-- FRAME 1 -->
        <div class="frame">
          <div class="master-grid">
            <!-- Zeile 1 -->
            <div></div> <!-- Spalte 1 leer -->
            <div class="label">DATE</div> <!-- Spalte 2 -->
            <div><input type="text" id="dateInput" maxlength="8" placeholder="TT.MM.JJ"></div> <!-- Spalte 3 -->
            <div class="label aero-label">FDL</div> <!-- Spalte 4 -->
            <div><input type="text" id="FDLinput"></div> <!-- Spalte 5 -->
            <div></div> <!-- Spalte 6 leer -->

            <!-- Zeile 2 -->
            <div></div> <!-- Spalte 1 leer -->
            <div class="label">LFZ</div> <!-- Spalte 2 -->
            <div><select id="lfzSelect"></select></div> <!-- Spalte 3 -->
            <div class="label aero-label">TEL:</div> <!-- Spalte 4 -->
            <div><input type="text" id="TELinput"></div> <!-- Spalte 5 -->
            <div></div> <!-- Spalte 6 leer -->

            <!-- Zeile 3 -->
            <div></div> <!-- Spalte 1 leer -->
            <div class="label">CALL SIGN</div> <!-- Spalte 2 -->
            <div id="callSignDisplay" class="callSignDisplay"></div> <!-- Spalte 3: Anzeige CALL SIGN -->
            <div class="label aero-label">TAC-CS</div> <!-- Spalte 4 -->
            <div><select id="tacSelect"></select></div> <!-- Spalte 5 -->
            <div></div> <!-- Spalte 6 leer -->
          </div>
        </div>

        <!-- FRAME 2-5 - LEGS -->
        <div id="legsContainer">

          <!-- Leg 1 -->
          <div class="frame">
            <div class="master-grid">

            <!-- Zeile 1 -->
              <div class="label leg-title" style="grid-row:1/4;">LEG 1</div> <!-- Spalte 1 -->
              <div class="label">ETD</div> <!-- Spalte 2 -->
              <input type="text" class="time legField etd"> <!-- Spalte 3 -->
              <div class="label aero-label">AERODROME</div> <!-- Spalte 4 -->
              <input type="text" class="aero legField aeroFrom"> <!-- Spalte 5 -->
        <div></div> <!-- Spalte 6 leer -->

            <!-- Zeile 2 -->
              <div class="label">ETA</div> <!-- Spalte 2 -->
              <input type="text" class="time legField eta"> <!-- Spalte 3 -->
              <div class="label aero-label">AERODROME</div> <!-- Spalte 4 -->
              <input type="text" class="aero legField aeroTo"> <!-- Spalte 5 -->
        <div></div> <!-- Spalte 6 leer -->

            <!-- Zeile 3 -->
              <div class="label">ALTERNATE</div> <!-- Spalte 2 -->
        <div></div> <!-- Spalte 3 leer -->
              <div class="label aero-label">AERODROME</div> <!-- Spalte 4 -->
              <input type="text" class="alt legField"> <!-- Spalte 5 -->
              <input type="text" class="alt legField col6"> <!-- Spalte 6 -->
            </div>
          </div>

          <!-- Leg 2 -->
          <div class="frame">
            <div class="master-grid">

            <!-- Zeile 1 -->
              <div class="label leg-title" style="grid-row:1/4;">LEG 2</div> <!-- Spalte 1 -->
              <div class="label">ETD</div> <!-- Spalte 2 -->
              <input type="text" class="time legField etd"> <!-- Spalte 3 -->
              <div class="label aero-label">AERODROME</div> <!-- Spalte 4 -->
              <input type="text" class="aero legField aeroFrom"> <!-- Spalte 5 -->
              <button class="legToggle col6" data-leg="2" data-state="active">ACTIVE</button> <!-- Spalte 6 -->

            <!-- Zeile 2 -->
              <div class="label">ETA</div> <!-- Spalte 2 -->
              <input type="text" class="time legField eta"> <!-- Spalte 3 -->
              <div class="label aero-label">AERODROME</div> <!-- Spalte 4 -->
              <input type="text" class="aero legField aeroTo"> <!-- Spalte 5 -->
        <div></div> <!-- Spalte 6 leer -->

            <!-- Zeile 3 -->
              <div class="label">ALTERNATE</div> <!-- Spalte 2 -->
        <div></div> <!-- Spalte 3 leer -->
              <div class="label aero-label">AERODROME</div> <!-- Spalte 4 -->
              <input type="text" class="alt legField"> <!-- Spalte 5 -->
              <input type="text" class="alt legField col6"> <!-- Spalte 6 -->
            </div>
          </div>

          <!-- Leg 3 -->
          <div class="frame">
            <div class="master-grid">

            <!-- Zeile 1 -->
              <div class="label leg-title" style="grid-row:1/4;">LEG 3</div> <!-- Spalte 1 -->
              <div class="label">ETD</div> <!-- Spalte 2 -->
              <input type="text" class="time legField etd"> <!-- Spalte 3 -->
              <div class="label aero-label">AERODROME</div> <!-- Spalte 4 -->
              <input type="text" class="aero legField aeroFrom"> <!-- Spalte 5 -->
              <button class="legToggle col6" data-leg="3" data-state="active">ACTIVE</button> <!-- Spalte 6 -->


            <!-- Zeile 2 -->
              <div class="label">ETA</div> <!-- Spalte 2 -->
              <input type="text" class="time legField eta"> <!-- Spalte 3 -->
              <div class="label aero-label">AERODROME</div> <!-- Spalte 4 -->
              <input type="text" class="aero legField aeroTo"> <!-- Spalte 5 -->
        <div></div> <!-- Spalte 6 leer -->

            <!-- Zeile 3 -->
              <div class="label">ALTERNATE</div> <!-- Spalte 2 -->
        <div></div> <!-- Spalte 3 leer -->
              <div class="label aero-label">AERODROME</div> <!-- Spalte 4 -->
              <input type="text" class="alt legField"> <!-- Spalte 5 -->
              <input type="text" class="alt legField col6"> <!-- Spalte 6 -->
            </div>
          </div>

          <!-- Leg 4 -->
          <div class="frame">
            <div class="master-grid">

            <!-- Zeile 1 -->
              <div class="label leg-title" style="grid-row:1/4;">LEG 4</div> <!-- Spalte 1 -->
              <div class="label">ETD</div> <!-- Spalte 2 -->
              <input type="text" class="time legField etd"> <!-- Spalte 3 -->
              <div class="label aero-label">AERODROME</div> <!-- Spalte 4 -->
              <input type="text" class="aero legField aeroFrom"> <!-- Spalte 5 -->
              <button class="legToggle col6" data-leg="4" data-state="active">ACTIVE</button> <!-- Spalte 6 -->

            <!-- Zeile 2 -->
              <div class="label">ETA</div> <!-- Spalte 2 -->
              <input type="text" class="time legField eta"> <!-- Spalte 3 -->
              <div class="label aero-label">AERODROME</div> <!-- Spalte 4 -->
              <input type="text" class="aero legField aeroTo"> <!-- Spalte 5 -->
        <div></div> <!-- Spalte 6 leer -->

            <!-- Zeile 3 -->
              <div class="label">ALTERNATE</div> <!-- Spalte 2 -->
        <div></div> <!-- Spalte 3 leer -->
              <div class="label aero-label">AERODROME</div> <!-- Spalte 4 -->
              <input type="text" class="alt legField"> <!-- Spalte 5 -->
              <input type="text" class="alt legField col6"> <!-- Spalte 6 -->
            </div>
          </div>

        <!-- BUTTON BOTTOM PANEL -->
        <div class="frame">
          <div class="routebtn">
            <button class="routebtnReset">Reset ETD/ETA</button>
            <button class="routebtnReset">Reset AERODROMES</button>
          </div>
        </div>
      </div>

      <datalist id="airfieldsList"></datalist>
      <datalist id="alternatesList"></datalist>

    </aside>

    <!-- RECHTS: wechselnder Content -->
    <main class="content-panel">

      <!-- VIEW: MAP -->
      <section id="view-map" class="view is-active">
         <div class="map-controls">
          <div class="ctrl-chip">
            <span>Weather</span>
            <button id="toggleWeather" type="button">OFF</button>
          </div>

          <div class="ctrl-chip">
            <span>Wind</span>
            <button id="toggleWind" type="button">OFF</button>
          </div>

          <div class="ctrl-chip">
            <span>Level</span>
            <select id="windLevelSelect">
              <option value="SFC">SFC</option>
              <option value="25">FL025</option>
              <option value="50">FL050</option>
              <option value="80">FL080</option>
              <option value="100">FL100</option>
              <option value="180">FL180</option>
            </select>
          </div>
        </div>
        <div class="map-frame" id="map"></div>
      </section>

      <!-- VIEW: CHECKLIST -->
      <section id="view-checklist" class="view">
        <div class="frame">
          <h2 class="view-title">Checklist</h2>
          <p class="view-sub">Platzhalter – hier kommt deine Checklist rein.</p>
        </div>
      </section>

      <!-- VIEW: FUEL -->
      <section id="view-fuel" class="view">
        <div class="frame fuel-card" id="fuelPanel">
          <div class="fuel-head">
            <p class="view-title">Fuel Planning</p>

            <div class="fuel-controls">
              <label class="fuel-chip">
                Standard Block
                <button type="button"
                        class="fuelToggle"
                        data-field="std_block"
                        data-state="on">
                  ON
                </button>
              </label>

              <label class="fuel-chip">
                Main (USG)
                <input data-field="main_usg" inputmode="decimal" />
              </label>

              <label class="fuel-chip">
                Aux Tanks
                <button type="button"
                        class="fuelToggle"
                        data-field="aux_on"
                        data-state="on">
                  26.4 USG
                </button>
              </label>
            </div>
          </div>

          <!-- GRID HEADER -->
          <div class="fuel-grid fuel-header">
            <div class="c-desc">ITEM</div>
            <div class="c-leg">LEG1</div>
            <div class="c-leg">LEG2</div>
            <div class="c-leg">LEG3</div>
            <div class="c-leg">LEG4</div>
            <div class="c-out">USG</div>
            <div class="c-out">TIME</div>
          </div>

          <!-- TRIP FUEL -->
          <div class="fuel-grid fuel-row">
            <div class="c-desc">Trip Fuel</div>
            <div class="c-leg trip" data-trip-leg="1"><input data-trip-usg="1" inputmode="decimal"></div>
            <div class="c-leg trip" data-trip-leg="2"><input data-trip-usg="2" inputmode="decimal"></div>
            <div class="c-leg trip" data-trip-leg="3"><input data-trip-usg="3" inputmode="decimal"></div>
            <div class="c-leg trip" data-trip-leg="4"><input data-trip-usg="4" inputmode="decimal"></div>
            <span data-out="trip_usg_sum"></span>
            <span data-out="trip_time_sum"></span>
          </div>

          <!-- COMPANY FUEL (Approaches) -->
          <div class="fuel-grid fuel-row">
            <div class="c-desc">
              Company Fuel
              <span class="sub">Approaches</span>
            </div>

            <div class="c-leg"></div>
            <div class="c-leg"></div>
            <div class="c-leg"></div>

                      <!-- LEG4: Stack -->
            <div class="c-leg leg-stack">
              <div class="mini">
                <label>IFR</label>
                <input data-field="appr_ifr_n" inputmode="numeric" placeholder="n" />
              </div>
              <div class="mini">
                <label>VFR</label>
                <input data-field="appr_vfr_n" inputmode="numeric" placeholder="n" />
              </div>
            </div>

            <span class="c-out" data-out="company_usg"></span>
            <span class="c-out" data-out="company_time"></span>
          </div>

          <!-- CONTINGENCY -->
          <div class="fuel-grid fuel-row">
            <div class="c-desc">Contingency (5% Trip + Company)</div>
            <div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div>
            <span class="c-out" data-out="cont_usg"></span>
            <span class="c-out" data-out="cont_time"></span>
          </div>

          <!-- ALTERNATE -->
          <div class="fuel-grid fuel-row">
            <div class="c-desc">Alternate Fuel (Log + 2.0 USG)</div>
            <div class="c-leg"></div><div class="c-leg"></div>
            <div class="c-leg leg-stack">
              <div class="mini">
                <label>USG (Log)</label>
              </div>
            </div>
            <div class="c-leg leg-stack">
              <input data-field="alt_usg_log" inputmode="decimal" />
            </div>
            <span class="c-out" data-out="alt_usg"></span>
            <span class="c-out" data-out="alt_time_out"></span>
          </div>

          <!-- FINAL RESERVE -->
          <div class="fuel-grid fuel-row">
            <div class="c-desc">Final Reserve (IFR/VFR)</div>
            <div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div>

            <div class="c-leg leg-stack">
              <select id="finres">
                <option value="IFR" selected>IFR</option>
                <option value="VFR">VFR</option>
              </select>
            </div>

            <span class="c-out" data-out="res_usg"></span>
            <span class="c-out" data-out="res_time"></span>
          </div>

          <!-- PLANNED TAKEOFF FUEL -->
          <div class="fuel-grid fuel-row">
            <div class="c-desc">Planned Takeoff Fuel</div>
            <div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div>
            <span class="c-out" data-out="planned_usg"></span>
            <span class="c-out" data-out="planned_time"></span>
          </div>

          <!-- EXTRA FUEL LRC -->
          <div class="fuel-grid fuel-row">
            <div class="c-desc">Extra Fuel LRC</div>
            <div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div>
            <span class="c-out extra-wrap">
              <span class="fuel-warn" data-out="extra_warn"></span>
              <span data-out="extra_lrc_usg"></span>
            </span>
            <span class="c-out" data-out="extra_lrc_time"></span>
          </div>

          <!-- TAKEOFF FUEL -->
          <div class="fuel-grid fuel-row fuel-total">
            <div class="c-desc">Takeoff Fuel</div>
            <div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div>
            <span class="c-out" data-out="takeoff_usg"></span>
            <span class="c-out" data-out="takeoff_time"></span>
          </div>

          <!-- TAXI -->
          <div class="fuel-grid fuel-row">
            <div class="c-desc">Taxi Fuel</div>
            <div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div>
            <span class="c-out" data-out="taxi_usg"></span>
            <span class="c-out" data-out="taxi_time"></span>
          </div>

          <!-- BLOCK FUEL -->
          <div class="fuel-grid fuel-row fuel-total">
            <div class="c-desc">Block Fuel</div>
            <div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div>
            <span class="c-out" data-out="block_usg_out"></span>
            <span class="c-out" data-out="block_time_out"></span>
          </div>

          <!-- TAXI -->
          <div class="fuel-grid fuel-row">
            <div class="c-desc">Taxi Fuel</div>
            <div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div>
            <span class="c-out" data-out="taxi_usg"></span>
            <span class="c-out" data-out="taxi_time"></span>
          </div>

          <!-- TRIP FUEL + COMPANY FUEL -->
          <div class="fuel-grid fuel-row">
            <div class="c-desc">Trip Fuel + Company Fuel</div>
            <div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div>
            <span class="c-out" data-out="trip_company_usg"></span>
            <span class="c-out" data-out="trip_company_time"></span>
          </div>

          <!-- LANDING FUEL -->
          <div class="fuel-grid fuel-row fuel-total">
            <div class="c-desc">Landing Fuel</div>
            <div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div><div class="c-leg"></div>
            <span class="c-out" data-out="landing_usg"></span>
            <span class="c-out" data-out="landing_time"></span>
          </div>

          <!-- REMAINING + ENDURANCE -->
          <div class="fuel-foot">
            <div class="fuel-kpis">
              <div class="kpi">
                <div class="kpi-label">Capacity</div>
                <div class="kpi-val"><span data-out="cap_usg"></span> USG</div>
              </div>
              <div class="kpi">
                <div class="kpi-label">Remaining</div>
                <div class="kpi-val"><span data-out="rem_usg"></span> USG</div>
              </div>
              <div class="kpi">
                <div class="kpi-label">Endurance NC (13.2)</div>
                <div class="kpi-val"><span data-out="end_nc"></span></div>
              </div>
              <div class="kpi">
                <div class="kpi-label">Endurance LRC (10.3)</div>
                <div class="kpi-val"><span data-out="end_lrc"></span></div>
              </div>
              <div class="kpi">
                <div class="kpi-label">Endurance MEC (6.5)</div>
                <div class="kpi-val"><span data-out="end_mec"></span></div>
              </div>
            </div>

            <div class="fuel-note">
              Trip Fuel/Time = manuell. Alle anderen Werte werden automatisch gerechnet (Approaches/Contingency/Reserve/Taxi/Alt).
            </div>
          </div>
        </div>
      </section>

      <!-- VIEW: PERFORMANCE -->
      <section id="view-performance" class="view">
        <div class="frame">
          <h2 class="view-title">Performance</h2>
          <p class="view-sub">Platzhalter – hier kommt Performance rein.</p>
        </div>
      </section>

      <!-- VIEW: SETTINGS -->
      <section id="view-settings" class="view">
        <div class="frame">
          <h2 class="view-title">Settings</h2>
          <p class="view-sub">Platzhalter – hier kommen Settings rein.</p>
        </div>
      </section>

    </main>
  </div>
</div>

</body>
</html>